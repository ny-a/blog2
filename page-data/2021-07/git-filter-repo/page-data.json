{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2021-07/git-filter-repo/","result":{"data":{"site":{"siteMetadata":{"title":"Blog"}},"markdownRemark":{"id":"f0377384-50ec-5b8c-af4e-d90643f2accd","excerpt":"Git を使っていて、何らかの理由でコミット履歴を書き換えたいとき、\n標準サブコマンドの中でよく使われるのは filter-branch でしょう。 ただ、公式ドキュメント\nを見てみると、filter-branch を使う代わりに、\nfilter-repo…","html":"<p>Git を使っていて、何らかの理由でコミット履歴を書き換えたいとき、\n標準サブコマンドの中でよく使われるのは filter-branch でしょう。</p>\n<p>ただ、<a href=\"https://git-scm.com/docs/git-filter-branch\">公式ドキュメント</a>\nを見てみると、filter-branch を使う代わりに、\n<a href=\"https://github.com/newren/git-filter-repo\">filter-repo</a>\nというサードパーティーの代替などを使うように警告されます。</p>\n<p>そこで、filter-repo を使ってみました。\nArchLinux では <a href=\"https://archlinux.org/packages/community/any/git-filter-repo/\">community/git-filter-repo</a>\nからインストールできます。</p>\n<p>今回やりたいことは (いつも同じで)、個人で使っているこのアカウントが\nAuthor/Committer となっているコミットを、仕事で使っている情報に書き換えることです。\n(毎回 git config をやり忘れるの、何か対策したいところですが……。)</p>\n<p>ドキュメントを見てみると、どうもあまりオプションはないようです。\nというより、Python のコードをオプションとして渡してあげると、\nいい感じに実行してくれるようです。</p>\n<p>今回はまだ自分しかコミットしていないリポジトリだったので、\n常に同じバイナリ列 (文字列ではダメです) を返すコードを書きます。</p>\n<p>……その前に、バックアップを取っておきます。\nfilter-repo では、clone したばかりの clean なリポジトリを使うことが推奨されています。\n/tmp で <code class=\"language-text\">git clone /path/to/repository --no-local</code> を実行して、リポジトリを複製します。</p>\n<p>次に、実際の書き換えを行っていきます。\n<code class=\"language-text\">--email-callback</code> と <code class=\"language-text\">--name-callback</code> を使います。\nどちらも現在の値を考慮する必要はないため、\n<code class=\"language-text\">&quot;return b&#39;user@example.com&#39;&quot;</code> のような引数を与えればいいです。</p>\n<p>そして実行すると……、一瞬で終わりました。\nfilter-branch では original が残りますが、filter-repo では残らないようです。\n軽く見た感じ問題なく完了しているようなので、\n<code class=\"language-text\">git push /path/to/repository branch:branch_new</code> を実行して、\n元のリポジトリに書き換えたコミットを push します。</p>\n<p>元のブランチと diff を取って、当然何も出ないことを確認したら、\n<code class=\"language-text\">git reset --hard branch_new</code> したり、\n<code class=\"language-text\">git branch -f branch branch_new</code> したりして古いブランチを新しいブランチに移動します。</p>\n<p>あとは、必要に応じて force push したり(関係するメンバーに謝りましょう……)、\n運よく push していなければ、もう二度と同じ誤ちを繰り返さないように心に誓ったりしましょう。</p>","frontmatter":{"title":"git filter-repoを使ってみました","date":"July 03, 2021"}}},"pageContext":{"slug":"2021-07/git-filter-repo/","previous":{"fields":{"slug":"2021-07/reactive-design-pattern/"},"frontmatter":{"title":"リアクティブなデザインパターン"}},"next":null}}}