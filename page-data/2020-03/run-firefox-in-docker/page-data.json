{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2020-03/run-firefox-in-docker/","result":{"data":{"site":{"siteMetadata":{"title":"Blog"}},"markdownRemark":{"id":"0e9511b0-dbc1-5776-8045-869e0fcaeb97","excerpt":"Qubes OS はアプリケーションを VM で分離しますが、 Arch Linux 上で Docker コンテナを利用して\n同じようなことを試してみました。 例えば、 Firefox を起動するには以下のようにします。 Dockerfile には USER instruction があるので、それを使って Xorg…","html":"<p><a href=\"https://www.qubes-os.org/\">Qubes OS</a> はアプリケーションを VM で分離しますが、 Arch Linux 上で Docker コンテナを利用して\n同じようなことを試してみました。</p>\n<p>例えば、 Firefox を起動するには以下のようにします。</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">sudo docker run --rm \\\n  -v /tmp/.X11-unix \\\n  -v ~/.Xauthority:/home/user/.Xauthority \\\n  -e DISPLAY \\\n  -e XAUTHORITY=/home/user/.Xauthority \\\n  --net host \\\n  archlinux/base \\\n  sh -c &#39;pacman -Syu --noconfirm firefox; useradd user; chown user:user /home/user; su user firefox&#39;</code></pre></div>\n<p>Dockerfile には USER instruction があるので、それを使って Xorg を起動中の UID と一致させればよいはずです。</p>\n<p><code class=\"language-text\">-v /home/user/.Xauthority</code> だけだとディレクトリとしてマウントされてしまってうまくいきませんでした。\n<code class=\"language-text\">--net host</code> を付けないと、リモートホストからの X 接続と認識されるため、 xhost などが必要になると思います。</p>\n<p>また、ウィンドウサイズを FullHD 程度にするとクラッシュしてしまう問題もあります。これはまだ解決法が分かっていませんが、\nSSH の X 転送を使って他のマシンの Firefox を起動したときは起きないため、Docker のメモリか cgroup か何かが原因かなと\n思っています。</p>\n<p>Arch Linux のインストールプロセスは overlayfs と親和性が高そうなので、 pacman のインストールを docker のレイヤーに\n置き換えたようなコンテナシステムを作りたいと思っていますが、 alpm hook 周りを理解しないといけなかったり、\nまだまだ先は長そうです。</p>","frontmatter":{"title":"Firefox の GUI を docker コンテナ内で起動する","date":"March 20, 2020"}}},"pageContext":{"slug":"2020-03/run-firefox-in-docker/","previous":{"fields":{"slug":"2020-03/subscribe-arch-mailing-lists/"},"frontmatter":{"title":"Arch Linux のメーリングリストを購読し始めました"}},"next":null}}}