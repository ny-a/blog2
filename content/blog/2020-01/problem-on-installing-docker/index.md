---
title:  "dockerのインストールでハマりました"
date:   2020-01-09
---

Docker のインストールは何度もやったことがあるのですが、稼働中のサーバー上でインストールした経験はなかったので、
(特殊な状況というか、あまり好ましくない状況ですが)ネットワーク周りで少しハマりました。

## 背景

稼働中のサービスがあるホストで、再起動は避けたい状況でした。

そのサービスのアップデートをデプロイする前に、docker コンテナ化したアップデート済みサービスを
デプロイして検証しようとしていました。

いやまあ検証環境分けろはそうなんですが……。

## 発生した問題

centos7 に docker をインストールし、docker-compose でコンテナを起動した所、
他のコンテナとはネットワークアクセス可能なのに、外部へのアクセスができない状況でした。

(直接？の原因としては、 iptables の FORWARD チェーンが DROP になっていました。)

iptables に docker 用のルールが自動で追加されるようなのですが(手元のマシンには追加されていました)、そのホストには
追加されていませんでした。

## 解決方法

`systemctl restart docker` を実行しました。終わり。

## まとめ？

普通にホスト再起動してあげましょう。
というかメンテナンスしよ？
